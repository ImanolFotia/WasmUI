"use strict";var Context={Debug:!0};function getString(e){let t=WasmContext.memory,r=new Uint32Array(t,e,2);return new TextDecoder("utf8").decode(new Uint8Array(t,r[0],r[1]))}function getStringFromPointer(e,t){let r=WasmContext.memory;return new TextDecoder("utf8").decode(new Uint8Array(r,e,t))}function wasm_print(e){let t=getString(e);return console.log(t),t.length}let lastTime=0,updateFps=1,numFrames=0,accumFrameTime=0,TargetFps=60,CompensateFps=0;function request_animation_frame(e){function t(){let r=Date.now()/1e3;var n=r-lastTime;if(lastTime=r,updateFps+=n,numFrames++,accumFrameTime+=n,updateFps>=1){let o=accumFrameTime/numFrames,i=Math.trunc(1/o);CompensateFps=(CompensateFps+Math.max(TargetFps-i,0))/2,document.getElementById("framerate").textContent=i+" ["+(1e3*o).toFixed(3)+"ms]",updateFps=0,numFrames=0,accumFrameTime=0}WasmContext.vtable.get(e)(n),setTimeout(t,1e3/(TargetFps+CompensateFps))}lastTime=Date.now()/1e3,setTimeout(t,1e3/(TargetFps+CompensateFps))}function sbrk(e){var t=WASM_HEAP,r=t+e,n=r-WASM_MEMORY.buffer.byteLength;return r>WASM_HEAP_MAX&&abort("MEM","Out of memory"),n>0&&(WASM_MEMORY.grow(n+65535>>16),MemorySetBufferViews()),WASM_HEAP=r,0|t}function ieee32ToFloat(e){var t,r,n,o=0;switch(n=2147483648&e?-1:1,t=e>>23&255,r=8388607&e,t){case 0:break;case 255:o=r?NaN:n>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;break;default:t-=127,r+=8388608,o=n*(r/8388608)*Math.pow(2,t)}return o}let time=function(){return Date.now()/1e3},getWindowWidth=function(){return WasmWindow.width},getWindowHeight=function(){return WasmWindow.height};function createEnvironment(){return{puts:wasm_print,wgpuGetDevice:wgpuGetDevice,wgpuGetPreferredCanvasFormat:wgpuGetPreferredCanvasFormat,wgpuCreateShaderModule:wgpuCreateShaderModule,wgpuCreateRenderPipeline:wgpuCreateRenderPipeline,wgpuCreateCommandEncoder:wgpuCreateCommandEncoder,wgpuSwapChainGetCurrentTextureView:wgpuSwapChainGetCurrentTextureView,wgpuCommandEncoderBeginRenderPass:wgpuCommandEncoderBeginRenderPass,wgpuRenderPassEncoderSetPipeline:wgpuRenderPassEncoderSetPipeline,wgpuRenderPassEncoderDraw:wgpuRenderPassEncoderDraw,wgpuRenderPassEncoderEnd:wgpuRenderPassEncoderEnd,wgpuDeviceGetQueue:wgpuDeviceGetQueue,wgpuCommandEncoderFinish:wgpuCommandEncoderFinish,wgpuTextureViewRelease:wgpuTextureViewRelease,wgpuCommandEncoderRelease:wgpuCommandEncoderRelease,wgpuRenderPassEncoderRelease:wgpuRenderPassEncoderRelease,wgpuCommandBufferRelease:wgpuCommandBufferRelease,wgpuRenderPassEncoderSetVertexBuffer:wgpuRenderPassEncoderSetVertexBuffer,wgpuQueueSubmit:wgpuQueueSubmit,wgpuCreateBuffer:wgpuCreateBuffer,wgpuDestroyBuffer:wgpuDestroyBuffer,wgpuBufferGetMappedRange:wgpuBufferGetMappedRange,wgpuBufferUnmap:wgpuBufferUnmap,wgpuDeviceCreateBindGroupLayout:wgpuDeviceCreateBindGroupLayout,wgpuCreatePipelineLayout:wgpuCreatePipelineLayout,wgpuReleaseBindGroupLayout:wgpuReleaseBindGroupLayout,wgpuReleasePipelineLayout:wgpuReleasePipelineLayout,wgpuReleaseBindGroup:wgpuReleaseBindGroup,wgpuCreateBindGroup:wgpuCreateBindGroup,wgpuRenderPassEncoderSetBindGroup:wgpuRenderPassEncoderSetBindGroup,wgpuQueueWriteBuffer:wgpuQueueWriteBuffer,wgpuCreateTexture:wgpuCreateTexture,wgpuCreateTextureView:wgpuCreateTextureView,wgpuQueueCopyExternalImageToTexture:wgpuQueueCopyExternalImageToTexture,wgpuCreateSampler:wgpuCreateSampler,request_animation_frame:request_animation_frame,getWindowWidth:getWindowWidth,getWindowHeight:getWindowHeight,time:time,gettimeofday:function(e){var t=Date.now();WasmContext.heapViewu32[e>>2]=t/1e3|0,WasmContext.heapViewu32[e+4>>2]=t%1e3*1e3|0},ceil:Math.ceil,exp:Math.exp,floor:Math.floor,log:Math.log,log10:Math.log10,pow:Math.pow,cos:Math.cos,trunc:Math.trunc,sin:Math.sin,tan:Math.tan,acos:Math.acos,asin:Math.asin,sqrt:Math.sqrt,atan:Math.atan2,fabs:Math.abs,round:Math.round,fopen:fopen,fread:fread,print_num:print_num,env_fetch:c_fetch,env_response_text:getResponseText,env_response_text_promise:getResponseTextPromise,env_promise_next:getPromiseNext,env_response_blob_promise:getResponseBlobPromise,env_createImageBitmap:c_createImageBitmap}}let files={};var numFiles=0;function readTextFile(e){var t=new XMLHttpRequest;return t.open("POST",e,!0),t.onreadystatechange=function(){4===t.readyState&&(200===t.status||0==t.status)&&console.log("file %s succefully loaded!",e)},t.send(null),t}let fopen=e=>{var t=getString(e);console.log("Trying to open:",t);var r=fetch(t);let n={};return n.file=r,n.text=void 0,files[++numFiles]=n,numFiles},fread=async(e,t,r,n)=>{var o;console.log("received file:",e);let i=new Int8Array(WasmContext.memory,t,r),s=await (await files[e].file).text(),a=[];s.split("").forEach(e=>{a.push(e.charCodeAt(0))}),i.set(a,0),WasmContext.vtable.get(n)(t),console.log("reading from buffer %d of size %d",t,r)};var promiseMgr={promises:{},numPromises:1,register:function(e){if(null==e)return;var t={};t.promise=e,t.count=1;let r=this.numPromises;return this.numPromises++,this.promises[r]=t,r},get:function(e){if(0!==e)return this.promises[e]},reference:function(e){0!==e&&this.promises[e].count++},dereference:function(){0!==id&&(this.promises[id].count--,this.promises[id].count<=0&&delete this.promises[id])},release:function(e){0!==e&&delete this.promises[e]}};let getPromiseNext=function(e,t){promiseMgr.get(e).promise.then(async e=>{if(Response.prototype.isPrototypeOf(e)?WasmContext.vtable.get(t)(promiseMgr.register(e)):Promise.prototype.isPrototypeOf(e)?WasmContext.vtable.get(t)(promiseMgr.register(e)):Blob.prototype.isPrototypeOf(e)?WasmContext.vtable.get(t)(promiseMgr.register(e)):ImageBitmap.prototype.isPrototypeOf(e)&&WasmContext.vtable.get(t)(promiseMgr.register(e)),"string"==typeof e){let r=e,n=new Uint8Array(WasmContext.memory,WasmContext.heap_base,r.length),o=[];r.split("").forEach(e=>{o.push(e.charCodeAt(0))}),n.set(o,0),WasmContext.vtable.get(t)(WasmContext.heap_base)}})},getResponseText=function(e,t){let r=promiseMgr.get(e).promise;WasmContext.vtable.get(t)(r())},getResponseTextPromise=e=>{let t=promiseMgr.get(e).promise;return promiseMgr.register(t.text())},getResponseBlobPromise=e=>{let t=promiseMgr.get(e).promise;return promiseMgr.register(t.blob())},getCreateImageBitmapPromise=function(e){},c_createImageBitmap=function(e){var t=promiseMgr.get(e).promise,r=createImageBitmap(t);return promiseMgr.register(r)},c_fetch=e=>{var t=fetch(getString(e));return promiseMgr.register(t)},print_num=function(e){console.log(e)};async function init(e){initWebGpu().then(async function(t){if(void 0===t||null==t){document.getElementById("not_available").style.display="flex",document.querySelector("canvas").style.display="none",document.getElementById("fps").style.display="none",WasmContext.deviceAvailable=!1;return}GlobalGPUContext.device=t,createEnvironment();let{instance:r}=await WebAssembly.instantiateStreaming(fetch(e),{env:createEnvironment()}).catch(function(e){console.error(e)});WasmContext.heap_base=r.exports.__heap_base.value,WasmContext.vtable=r.exports.__indirect_function_table,WasmContext.memory=r.exports.memory.buffer,WasmContext.exports=r.exports,WasmContext.heapViewu8=new Uint8Array(WasmContext.memory),WasmContext.heapViewu16=new Uint16Array(WasmContext.memory),WasmContext.heapViewu32=new Uint32Array(WasmContext.memory),WasmContext.heapViewf32=new Float32Array(WasmContext.memory),WasmContext.heapView32=new Int32Array(WasmContext.memory);let n=navigator.gpu.getPreferredCanvasFormat();GlobalGPUContext.context.configure({device:GlobalGPUContext.device,format:n}),r.exports.__wasm_call_ctors&&r.exports.__wasm_call_ctors(),WasmWindow.width=GlobalGPUContext.context.canvas.width,WasmWindow.height=GlobalGPUContext.context.canvas.height;try{r.exports.__main_argc_argv()}catch(o){console.log(o)}})}